{% extends 'agrosmart/base.html' %}

{% block contenido %}
{% load static %}
{% load agrosmartiotweb %}
{% load humanize %}

<style>
    @media (max-width: 768px) {
        canvas {
            height: 400px !important; /* Aumenta la altura en dispositivos móviles */
        }
    }
</style>

<div class="finanzas">
    <br><br>
    <div class="card">
        <div class="card-body">
            <h3>Gestión de Finanzas por Trabajador</h3>
            <hr>
            <div>
                <table class="table table-striped table-hover table-responsive" style="overflow-x: auto;">
                    <thead>
                        <tr>
                            <th>Nombre Trabajador</th>
                            <th>Trabajo a Realizar</th>
                            <th>Cobro por Hora</th>
                            <th>Cantidad Jornadas</th>
                            <th>Horas Trabajadas</th>
                            <th>Total a Pagar</th>
                            <th>Estado de Pago</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for finanza in finanzas %}
                        <tr>
                            <td>{{ finanza.trabajador.nombre }}</td>
                            <td>{{ finanza.trabajo_realiza }}</td>
                            <td>{{ finanza.cobro_por_hora }}</td>
                            <td>{{ finanza.cantidad_jornadas }}</td>
                            <td>{{ finanza.horas_trabajadas }}</td>
                            <td>{{ finanza.total_a_pagar }}</td>
                            <td>{{ finanza.get_estado_pago_display }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <div class="card-body">
            <h3>Gestión de Finanzas por Mes</h3>
            <hr>
            <div>
                <table class="table table-striped table-hover table-responsive" style="overflow-x: auto;">
                    <thead>
                        <tr>
                            <th>Mes</th>
                            <th>Gastos en Remuneración</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for finanza_por_mes in finanzas_por_mes %}
                        <tr>
                            <td>{{ finanza_por_mes.mes }}</td>
                            <td>{{ finanza_por_mes.total_gastos_en_remuneracion }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                <h4>Gráfico de Gastos en Remuneración por Mes</h4>
                <canvas id="finanzasChart" height="300"></canvas>
            </div>
        </div>
        <br>
        <div class="card-body">
            <h3>Gastos Financieros</h3>
            <hr>
            <div>
                <table class="table table-striped table-hover table-responsive" style="overflow-x: auto;">
                    <thead>
                        <tr>
                            <th>Mes</th>
                            <th>Gastos Financieros</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for gasto in gastos_por_mes %}
                        <tr>
                            <td>{{ gasto.mes }}</td>
                            <td>{{ gasto.total|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        <br>
    </div>
</div>

